<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Emax Model Analysis with Stan â€¢ rstanemax</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><script src="deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Emax Model Analysis with Stan">
<meta name="description" content="Perform sigmoidal Emax model fit using Stan in a formula notation, without writing Stan model code.">
<meta property="og:description" content="Perform sigmoidal Emax model fit using Stan in a formula notation, without writing Stan model code.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">rstanemax</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/emaxmodel.html">Simple Emax model fit with Stan</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/yoshidk6/rstanemax/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="rstanemax">rstanemax<a class="anchor" aria-label="anchor" href="#rstanemax"></a>
</h1></div>
<p><a href="https://github.com/yoshidk6/rstanemax/actions" class="external-link"><img src="https://github.com/yoshidk6/rstanemax/workflows/R-CMD-check/badge.svg" alt="R build status"></a> <a href="https://cran.r-project.org/package=rstanemax" class="external-link"><img src="https://www.r-pkg.org/badges/version/rstanemax" alt="CRAN status"></a> <a href="https://CRAN.R-project.org/package=rstanemax" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/grand-total/rstanemax" alt="downloads"></a></p>
<p>This small package performs simple sigmoidal Emax model fit using Stan, without the need of (1) writing Stan model code and (2) setting up an environment to compile Stan model, inspired by <strong>rstanarm</strong> package.</p>
<p><strong>rstanarm</strong> package (<a href="https://mc-stan.org/users/interfaces/rstanarm" class="external-link">link</a>) is a very flexible, general purpose tool to perform various Bayesian modeling with formula notations, such as generalized mixed effect models or joint models. One small gap it has is in nonlinear model fitting, where it only accepts nonlinear functions defined in stats package with <code>SS</code> prefixes (<a href="http://mc-stan.org/rstanarm/articles/glmer.html#relationship-to-nlmer" class="external-link">link</a>). Unfortunately the (sigmoidal) Emax model, one of the most commonly used nonlinear functions in the field of pharmacometrics, is not among the available functions. The <strong>rstanarm</strong> package also seems to be assuming that we fit nonlinear mixed effect models, but not simple nonlinear models without mixed effects. <strong>brms</strong> is another great general purpose package that allows formula notation, but it requires users to compile generated Stan models. The need for setting up an environment for compiling Stan code can be daunting for beginners, especially with Windows.</p>
<p>I hope this <strong>rstanemax</strong> package will fill the niche gap, allow for easier implementation of Emax model in Bayesian framework, and enable routine uses in the pharmacokinetic/pharmacodynamic field.</p>
<p>This package was build using <strong>rstantools</strong> (<a href="https://mc-stan.org/rstantools/" class="external-link">link</a>) following a very helpful step-by-step guide (<a href="https://mc-stan.org/rstantools/articles/minimal-rstan-package.html" class="external-link">link</a>) on creating a package that depends on RStan.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="section level3">
<h3 id="from-cran">From CRAN<a class="anchor" aria-label="anchor" href="#from-cran"></a>
</h3>
<p>You can install the released version of rstanemax from <a href="https://CRAN.R-project.org" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rstanemax"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="from-source">From source<a class="anchor" aria-label="anchor" href="#from-source"></a>
</h3>
<p>You can alternatively install the package from source.<br>
Before doing so, you first have to install RStan and C++ Toolchain.<br><a href="https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started" class="external-link">RStan Getting Started</a><br>
Also, you have to follow the instruction below if you are using Windows PC.<br><a href="https://github.com/stan-dev/rstan/wiki/Installing-RStan-from-source-on-Windows" class="external-link">Installing RStan from source on Windows</a></p>
<p>After this step you should be able to install the package from GitHub using <strong>devtools</strong>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"yoshidk6/rstanemax"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p><a href="https://yoshidk6.github.io/rstanemax/">This GitHub pages</a> contains function references and <a href="https://yoshidk6.github.io/rstanemax/articles/emaxmodel.html">vignette</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load rstanemax</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yoshidk6/rstanemax" class="external-link">rstanemax</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Rcpp</span></span>
<span></span>
<span><span class="co"># Run model with a sample dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">exposure.response.sample</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit.emax</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/stan_emax.html">stan_emax</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="va">exposure</span>, data <span class="op">=</span> <span class="va">exposure.response.sample</span>,</span>
<span>                      <span class="co"># the next line is only to make the output short</span></span>
<span>                      chains <span class="op">=</span> <span class="fl">1</span>, iter <span class="op">=</span> <span class="fl">500</span>, seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'emax' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 8.1e-05 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.81 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:   1 / 500 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  50 / 500 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 100 / 500 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 150 / 500 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 200 / 500 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 250 / 500 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 251 / 500 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 300 / 500 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 350 / 500 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 400 / 500 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 450 / 500 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 500 / 500 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 0.158951 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                0.065293 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                0.224244 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; http://mc-stan.org/misc/warnings.html#tail-ess</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.emax</span></span>
<span><span class="co">#&gt; ---- Emax model fit with rstanemax ----</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        mean se_mean    sd  2.5%   25%   50%   75%  97.5%  n_eff Rhat</span></span>
<span><span class="co">#&gt; emax  92.01    0.47  6.49 79.08 87.94 92.11 96.35 103.43 188.95    1</span></span>
<span><span class="co">#&gt; e0     5.69    0.35  4.92 -2.87  2.13  5.90  9.07  15.00 192.44    1</span></span>
<span><span class="co">#&gt; ec50  75.78    1.23 19.37 44.51 62.88 72.26 85.34 124.31 246.47    1</span></span>
<span><span class="co">#&gt; gamma  1.00     NaN  0.00  1.00  1.00  1.00  1.00   1.00    NaN  NaN</span></span>
<span><span class="co">#&gt; sigma 16.65    0.13  1.66 13.77 15.47 16.55 17.55  20.20 157.45    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Use `extract_stanfit()` function to extract raw stanfit object</span></span>
<span><span class="co">#&gt; * Use `extract_param()` function to extract posterior draws of key parameters</span></span>
<span><span class="co">#&gt; * Use `plot()` function to visualize model fit</span></span>
<span><span class="co">#&gt; * Use `posterior_predict()` or `posterior_predict_quantile()` function to get</span></span>
<span><span class="co">#&gt;   raw predictions or make predictions on new data</span></span>
<span><span class="co">#&gt; * Use `extract_obs_mod_frame()` function to extract raw data </span></span>
<span><span class="co">#&gt;   in a processed format (useful for plotting)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit.emax</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-3-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p><a href="https://www.kristianbrock.com/post/emax-intro/" class="external-link">Fitting the Emax Model in R</a> has nice intro on Emax (with kindly introducing this package). <strong>brms</strong> implementation of the same model can be found <a href="https://rpubs.com/mvuorre/emax-brms" class="external-link">here</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=rstanemax" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/yoshidk6/rstanemax/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/yoshidk6/rstanemax/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a> | file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing rstanemax</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Kenta Yoshida <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-4967-3831" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Danielle Navarro <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-7648-6578" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kenta Yoshida, Danielle Navarro.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
